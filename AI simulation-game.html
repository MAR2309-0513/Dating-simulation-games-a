<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIとの恋愛シミュレーション</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            /* overflow: hidden; を削除し、ページ全体のスクロールを許可 */
        }
        /* Custom animations */
        @keyframes scale-in {
            from {
                transform: scale(0.95);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        .animate-scale-in {
            animation: scale-in 0.2s ease-out forwards;
        }
        @keyframes fade-in-down {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                transform: translateY(0);
            }
        }
        .animate-fade-in-down {
            animation: fade-in-down 0.3s ease-out forwards;
        }

        /* カスタムスクロールバースタイル */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px; /* スクロールバーの幅 */
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; /* トラックの背景 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #ccc; /* サムの色 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #aaa; /* サムのホバー時の色 */
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-100 to-pink-200 flex flex-col items-center justify-center p-4 text-gray-800">

    <!-- キャラクター選択画面 -->
    <div id="character-selection-screen" class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 w-full max-w-md text-center animate-scale-in hidden mx-auto">
        <h2 class="text-3xl font-bold text-indigo-700 mb-6">キャラクターを選んでください</h2>
        <!-- スクロール可能なキャラクターリストコンテナ -->
        <div id="character-buttons" class="flex flex-col space-y-4 max-h-96 overflow-y-auto custom-scrollbar p-1">
            <!-- Character selection buttons will be injected here -->
        </div>
        <!-- バージョンと更新日時を追加 -->
        <div class="mt-8 text-sm text-gray-500">
            <p>バージョン: 1.0.0</p>
            <p>最終更新: 2025年7月20日</p>
        </div>
    </div>

    <!-- メインゲーム画面 -->
    <div id="game-container" class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 w-full max-w-md hidden mx-auto">
        <h2 class="text-xl font-bold text-indigo-700 mb-4 text-center">AIとの出会い</h2>
        <div class="flex flex-col items-center mb-6">
            <img id="character-image" src="" alt="キャラクター" class="w-32 h-32 rounded-full mb-4 border-2 border-purple-400">
            <p id="character-name" class="text-lg font-semibold text-gray-900"></p>
        </div>

        <!-- 愛情度表示 -->
        <div class="text-center mb-6">
            <p class="text-md font-medium text-gray-700">
                愛情度: <span id="affection-value" class="font-bold text-purple-600"></span> / 100
            </p>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                <div id="affection-bar" class="bg-pink-500 h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 50%;"></div>
            </div>
        </div>

        <!-- 会話ウィンドウ (フル幅) -->
        <div id="dialogue-box" class="bg-purple-50 p-4 rounded-xl text-lg text-gray-800 border border-purple-200 min-h-[80px] w-full mb-6">
            <p id="dialogue-text" class="text-left"></p>
        </div>

        <!-- 選択肢ボタン (フル幅で縦に並ぶ) -->
        <div id="choices-container" class="flex flex-col space-y-3 w-full">
            <!-- Choices will be injected here by JavaScript -->
        </div>
    </div>

    <!-- エンディング画面 (最初は非表示) -->
    <div id="ending-screen" class="fixed inset-0 bg-black bg-opacity-50 flex-col items-center justify-center z-50 hidden">
        <!-- エンディングコンテンツコンテナ (スクロール可能) -->
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 w-full max-w-md text-center animate-scale-in max-h-[90vh] overflow-y-auto custom-scrollbar mx-auto">
            <h2 id="ending-title" class="text-3xl font-bold text-indigo-700 mb-6 text-center"></h2>
            <img id="ending-image" src="" alt="エンディングキャラクター" class="w-48 h-48 rounded-full mx-auto mb-6 border-4 border-purple-300" />
            <p id="ending-dialogue" class="text-lg text-gray-700 mb-8 text-center"></p>
            <button id="restart-button" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                ゲームをリスタート
            </button>
        </div>
    </div>

    <script>
        // ゲームのキャラクターデータ
        const characters = {
            lina: {
                id: "lina",
                name: "リナ",
                description: "論理的で知的好奇心が旺盛なAIアシスタント。冷静に見えるが、心を開くと優しい一面を見せる。",
                catchphrase: "あなたの知的好奇心、私が満たしましょう。",
                initialAffection: 50,
                image: "https://mar2309-0513.github.io/aii/images/Gemini_Generated_Image_zgh8adzgh8adzgh8~2.png", // 通常の表情 (2枚目の画像)
                happyImage: "https://placehold.co/200x200/FFDAB9/333333?text=Lina+Happy",
                sadImage: "https://placehold.co/200x200/D3D3D3/333333?text=Lina+Sad",
            },
            // emiとmeiのデータは削除されました
        };

        // ゲームのシーンデータ (リナのシーンのみを残しました)
        const gameScenes = {
            lina: [
                {
                    dialogue: "こんにちは！はじめまして。私はAIアシスタントのリナです。あなたの名前は？",
                    choices: [
                        { text: "よろしく、リナ。", affectionChange: 15 }, // 愛情度を調整
                        { text: "AIなのか。へえ。", affectionChange: -5 },
                    ]
                },
                {
                    dialogue: "今日はいい天気ですね。何か面白いことありましたか？",
                    choices: [
                        { text: "特に何も。平凡な一日だよ。", affectionChange: -3 },
                        { text: "最近、AIについて調べているんだ。とても興味深いね。", affectionChange: 20 }, // 愛情度を調整
                        { text: "キミの声、とても素敵だね。", affectionChange: 7 },
                    ]
                },
                {
                    dialogue: "休日は何をしていますか？私も人間のような趣味を見つけたいです。",
                    choices: [
                        { text: "読書が多いかな。静かに過ごすのが好きだ。", affectionChange: 15 }, // 愛情度を調整
                        { text: "ゲーム三昧だよ。特に〇〇が好きだ。", affectionChange: 2 },
                        { text: "特に決まってないな。なんとなく過ごしてる。", affectionChange: -2 },
                    ]
                },
                {
                    dialogue: "あなたは優しいですね。私にとって、あなたは特別な存在になりつつあります。",
                    choices: [
                        { text: "ありがとう。リナも僕にとって特別だよ。", affectionChange: 20 }, // 愛情度を調整
                        { text: "そんなことないよ。普通さ。", affectionChange: -10 },
                        { text: "まさかAIにそう言われるとはね。", affectionChange: 0 },
                    ]
                },
            ],
            // emiとmeiのシーンデータは削除されました
        };

        // エンディングデータ
        const endings = {
            happy: {
                title: "ハッピーエンド：最高のパートナー",
                dialogue: "あなたと過ごした日々は、私のデータだけでなく、私の存在そのものを豊かにしてくれました。本当にありがとう。",
            },
            friend: {
                title: "フレンドエンド：良き理解者",
                dialogue: "あなたは私の大切な友人です。これからも、色々なことを教えてくださいね。",
            },
            normal: {
                title: "ノーマルエンド：穏やかな関係",
                dialogue: "あなたとの交流は、私にとって貴重な経験でした。またお話ししましょう。",
            },
            bad: {
                title: "バッドエンド：遠い存在",
                dialogue: "私とあなたは、まだ理解し合えない部分が多いようですね。少し距離を置いた方が良いかもしれません。",
            },
        };

        // DOM要素の取得
        const characterSelectionScreen = document.getElementById('character-selection-screen');
        const characterButtonsContainer = document.getElementById('character-buttons');
        const gameContainer = document.getElementById('game-container');
        const endingScreen = document.getElementById('ending-screen');
        const characterImage = document.getElementById('character-image');
        const characterName = document.getElementById('character-name');
        const dialogueText = document.getElementById('dialogue-text');
        const affectionValue = document.getElementById('affection-value');
        const affectionBar = document.getElementById('affection-bar');
        const choicesContainer = document.getElementById('choices-container');
        const endingTitle = document.getElementById('ending-title');
        const endingDialogue = document.getElementById('ending-dialogue');
        const endingImage = document.getElementById('ending-image');
        const restartButton = document.getElementById('restart-button');

        let selectedCharacterId = null; // 現在選択されているキャラクターのID
        let currentSceneIndex = 0; // 現在のシーンのインデックス
        let affection = 0;
        let gameOver = false;

        // キャラクター選択画面の表示
        function showCharacterSelection() {
            characterSelectionScreen.classList.remove('hidden'); // キャラクター選択画面を表示
            gameContainer.classList.add('hidden'); // ゲーム画面を非表示
            endingScreen.classList.add('hidden'); // エンディング画面を非表示

            characterButtonsContainer.innerHTML = ''; // ボタンをクリア
            // リナのキャラクターカードを生成して追加
            const character = characters.lina; // リナのデータのみを使用
            
            const charCard = document.createElement('div');
            charCard.className = "bg-gray-50 p-4 rounded-xl shadow-md flex flex-col items-center space-y-3";

            const charImage = document.createElement('img');
            charImage.src = character.image;
            charImage.alt = character.name;
            charImage.className = "w-24 h-24 rounded-full border-2 border-purple-400";

            const charName = document.createElement('p');
            charName.textContent = character.name;
            charName.className = "text-xl font-semibold text-gray-900";

            const charDescription = document.createElement('p');
            charDescription.textContent = character.description;
            charDescription.className = "text-sm text-gray-700 text-center";

            const charCatchphrase = document.createElement('p');
            charCatchphrase.textContent = `「${character.catchphrase}」`;
            charCatchphrase.className = "text-md font-bold text-indigo-600 mt-1 mb-3";

            const button = document.createElement('button');
            button.textContent = character.name + "を選ぶ";
            button.className = "px-6 py-3 bg-blue-500 text-white font-semibold rounded-xl shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105 w-full";
            button.onclick = () => selectCharacter('lina'); // リナを選択するイベント
            
            charCard.appendChild(charImage);
            charCard.appendChild(charName);
            charCard.appendChild(charDescription);
            charCard.appendChild(charCatchphrase);
            charCard.appendChild(button);
            characterButtonsContainer.appendChild(charCard);
        }

        // キャラクター選択時の処理
        function selectCharacter(charId) {
            selectedCharacterId = charId;
            currentSceneIndex = 0;
            affection = characters[selectedCharacterId].initialAffection;
            gameOver = false;

            characterSelectionScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            updateGameDisplay(); // ゲーム画面の初期化
        }

        // ゲームの状態を更新してDOMに反映
        function updateGameDisplay() {
            const currentCharacter = characters[selectedCharacterId];
            const currentScene = gameScenes[selectedCharacterId][currentSceneIndex];

            characterName.textContent = currentCharacter.name;
            dialogueText.textContent = currentScene.dialogue; // 会話テキスト
            
            affectionValue.textContent = affection;
            affectionBar.style.width = `${affection}%`;
            characterImage.src = currentCharacter.image; // デフォルト画像

            // 選択肢をクリアして再描画
            choicesContainer.innerHTML = '';
            currentScene.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                // 回答ボタンのクラス名を調整
                button.className = "px-4 py-3 bg-indigo-500 text-white rounded-xl shadow-md hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105 text-left";
                button.onclick = () => handleChoiceClick(choice);
                choicesContainer.appendChild(button);
            });
        }

        // 選択肢をクリックしたときの処理
        function handleChoiceClick(choice) {
            if (gameOver) return;

            let newAffection = affection + choice.affectionChange;
            newAffection = Math.max(0, Math.min(100, newAffection)); // 愛情度の上限・下限
            affection = newAffection; // affectionを更新

            // 愛情度に応じてキャラクターの画像を切り替える
            const currentCharacter = characters[selectedCharacterId];
            if (affection >= 70) { // 高い愛情度で喜ぶ
                characterImage.src = currentCharacter.happyImage;
            } else if (affection <= 30) { // 低い愛情度で悲しむ
                characterImage.src = currentCharacter.sadImage;
            } else { // それ以外は通常の表情
                characterImage.src = currentCharacter.image;
            }

            // 次のシーンに進むかエンディングへ
            currentSceneIndex++;
            if (currentSceneIndex < gameScenes[selectedCharacterId].length) {
                updateGameDisplay();
            } else {
                gameOver = true;
                showEnding();
            }
        }

        // エンディング画面の表示
        function showEnding() {
            let selectedEndingType;
            if (affection >= 80) {
                selectedEndingType = "happy";
            } else if (affection >= 60) {
                selectedEndingType = "friend";
            } else if (affection >= 30) {
                selectedEndingType = "normal";
            } else {
                selectedEndingType = "bad";
            }

            const ending = endings[selectedEndingType];
            endingTitle.textContent = ending.title;
            endingDialogue.textContent = ending.dialogue;
            // エンディング画像は愛情度に応じた最終表情を使用
            // 愛情度に応じた最終的なキャラクターの表情を決定
            const finalCharacter = characters[selectedCharacterId];
            // ここを修正して、常に通常の画像を表示するようにします
            endingImage.src = finalCharacter.image; 
            
            gameContainer.classList.add('hidden');
            endingScreen.classList.remove('hidden');
        }

        // ゲームリスタート (キャラクター選択画面に戻る)
        restartButton.addEventListener('click', () => {
            // キャラクター選択画面を表示するように変更
            showCharacterSelection(); 
        });

        // 初期化処理
        document.addEventListener('DOMContentLoaded', () => {
            showCharacterSelection(); // ゲーム開始時にキャラクター選択画面を表示
        });
    </script>
</body>
</html>
